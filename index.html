<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>7AYA GAME</title>
  <link rel="apple-touch-icon" href="IMG_0383.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="7AYA-GAME">
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: white;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    input, select, button {
      margin: 5px;
      padding: 8px;
      border-radius: 5px;
      border: none;
    }
    button {
      background: #0a74da;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #055aab;
    }
    .hidden {
      display: none;
    }
    .card {
      padding: 20px;
      border-radius: 15px;
      margin-top: 15px;
      position: relative;
      color: white;
    }
    #cardView img {
      margin-top: 10px;
    }
    #facenetPosts > div {
      background: #222;
      margin-top: 10px;
      padding: 10px;
      border-radius: 10px;
    }
    #facenetPosts img, #facenetPosts video {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 5px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<!-- 🔐 Login -->
<div id="login">
  <h2>Login</h2>
  <input id="username" placeholder="Username" autocomplete="off" />
  <input id="pin" placeholder="PIN" type="password" autocomplete="off" />
  <label><input type="checkbox" id="keepSigned" /> Keep me signed in</label><br/>
  <button onclick="login()">Login</button>
</div>

<!-- 🧩 Main App -->
<div id="main" class="hidden">
  <h2 id="welcome"></h2>
  <p>🕒 Game Time: <span id="gameTime">--:--:-- --</span></p>
  <p>💰 Money: <span id="money"></span> EGP</p>
  <p>📞 Phone: <span id="phone"></span></p>
  <p>📶 Raseed: <span id="raseed"></span> | Internet: <span id="internet"></span> MB</p>
  <button onclick="logout()">Logout</button>

  <hr />
  <h3>🎴 Card</h3>
  <input id="cardPin" placeholder="Set 3-digit PIN" maxlength="3" autocomplete="off"/>
  <button onclick="makeCard()">Make Card</button><br/>
  <input id="openCardPin" placeholder="Enter Card PIN" maxlength="3" autocomplete="off"/>
  <button onclick="openCard()">Open Card</button>
  <div id="cardView" class="card hidden"></div>

  <hr />
  <h3>🧠 FaceNet</h3>
  <div id="facenetPosts"></div>
</div>

<!-- 🔊 Audio -->
<audio id="successSound" src="https://audio.jukehost.co.uk/1aTbUcc5vRSDBHlwrgNMrAszF5BJ3Q8J" preload="auto"></audio>

<!-- 📜 JavaScript -->
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD8LLjhoQEefz6dYdhSVbFOsIqvizO8WaY",
    authDomain: "aya-game-e579b.firebaseapp.com",
    databaseURL: "https://aya-game-e579b-default-rtdb.firebaseio.com",
    projectId: "aya-game-e579b",
    storageBucket: "aya-game-e579b.appspot.com",
    messagingSenderId: "425563173336",
    appId: "1:425563173336:web:4de74ff9fcd07d..."
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUser = null;

  function getUserGradientColor(username) {
    const hash = Array.from(username).reduce((acc, c) => acc + c.charCodeAt(0), 0);
    const hue = hash % 360;
    return `linear-gradient(135deg, hsl(${hue}, 70%, 60%), hsl(${(hue + 40) % 360}, 70%, 40%))`;
  }

  function openCard() {
    const pin = document.getElementById("openCardPin").value.trim();
    if (pin.length !== 3 || isNaN(pin)) return alert("Enter valid 3-digit PIN");
    db.ref("users/" + currentUser + "/card").once("value").then(snap => {
      if (!snap.exists()) return alert("No card found");
      const card = snap.val();
      if (card.pin !== pin) return alert("Wrong PIN");
      const country = card.country || "N/A";
      const cardView = document.getElementById("cardView");
      const gradient = getUserGradientColor(currentUser);
      cardView.style.background = gradient;
      cardView.innerHTML = `
        <strong>Card Number:</strong> ${card.number} <br/>
        <strong>User:</strong> ${currentUser.toUpperCase()} <br/>
        <strong>Country:</strong> ${country} <br/>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${currentUser}" alt="QR Code" />
      `;
      cardView.classList.remove("hidden");
    });
  }

  function login() {
    const user = document.getElementById("username").value.trim().toLowerCase();
    const pin = document.getElementById("pin").value.trim();
    if (!user || !pin) return alert("Enter username and PIN");
    db.ref("users/" + user + "/pin").once("value").then(snap => {
      if (!snap.exists()) return alert("User not found");
      if (snap.val() !== pin) return alert("Incorrect PIN");
      currentUser = user;
      if (document.getElementById("keepSigned").checked) {
        localStorage.setItem("7ayaUser", user);
      } else {
        sessionStorage.setItem("7ayaUser", user);
      }
      loadUser();
    });
  }

  function logout() {
    localStorage.removeItem("7ayaUser");
    sessionStorage.removeItem("7ayaUser");
    currentUser = null;
    document.getElementById("main").classList.add("hidden");
    document.getElementById("login").classList.remove("hidden");
  }

  function loadUser() {
    db.ref("users/" + currentUser).on("value", snap => {
      const data = snap.val();
      document.getElementById("welcome").innerText = "Welcome, " + currentUser.toUpperCase();
      document.getElementById("money").innerText = data.money || 0;
      document.getElementById("phone").innerText = data.phone || "N/A";
      document.getElementById("raseed").innerText = data.raseed || 0;
      document.getElementById("internet").innerText = data.internet || 0;
    });
    document.getElementById("login").classList.add("hidden");
    document.getElementById("main").classList.remove("hidden");
  }

  function makeCard() {
    const pin = document.getElementById("cardPin").value.trim();
    if (pin.length !== 3 || isNaN(pin)) return alert("Enter valid 3-digit PIN");
    const number = Math.floor(Math.random() * 1000000);
    db.ref("users/" + currentUser + "/card").set({
      pin,
      number,
      country: "Egypt"
    }).then(() => alert("Card created!"));
  }

  function startGameClock() {
    setInterval(() => {
      const now = new Date();
      const formatted = now.toLocaleTimeString('en-US');
      document.getElementById("gameTime").innerText = formatted;
    }, 1000);
  }

  window.onload = function() {
    startGameClock();
    const savedUser = localStorage.getItem("7ayaUser") || sessionStorage.getItem("7ayaUser");
    if (savedUser) {
      currentUser = savedUser;
      loadUser();
    }
  };
</script>
</body>
</html>
