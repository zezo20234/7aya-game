<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>7AYA Game</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    #app { padding: 20px; max-width: 500px; margin: auto; }
    .hidden { display: none; }
    .card { border-radius: 10px; background: #000; color: white; padding: 20px; margin-top: 10px; position: relative; }
    .post img { max-width: 100%; border-radius: 5px; }
    .post { background: white; padding: 10px; margin-top: 10px; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
  </style>
</head>
<body>
<div id="app">
  <div id="login">
    <h2>Login</h2>
    <input id="username" placeholder="Username" /><br/>
    <input id="pin" placeholder="PIN" type="password" /><br/>
    <label><input type="checkbox" id="keepSigned" /> Keep me signed in</label><br/>
    <button onclick="login()">Login</button>
  </div>
  <div id="main" class="hidden">
    <h2 id="welcome"></h2>
    <div><strong>Money:</strong> <span id="money"></span> EGP</div>
    <div><strong>Phone:</strong> <span id="phone"></span></div>
    <button onclick="logout()">Logout</button>
    <hr>
        <!-- Make Card -->
    <h3>Make Card</h3>
    <input id="cardPin" placeholder="Set 3-digit PIN" maxlength="3" /><br/>
    <button onclick="makeCard()">Make Card</button>

    <!-- Open Card -->
    <h3>Open Card</h3>
    <input id="openCardPin" placeholder="Enter Card PIN" maxlength="3" /><br/>
    <button onclick="openCard()">Open Card</button>
    <div id="cardArea" class="card hidden">
      <div><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/Mastercard-logo.png/320px-Mastercard-logo.png" height="30" /></div>
      <div id="cardNumber" style="margin: 10px 0; font-size: 20px;"></div>
      <div><img id="cardQR" /></div>
      <div style="position: absolute; bottom: 10px; left: 10px;"><strong id="cardUser"></strong></div>
    </div>

    <!-- Buy Phone Number -->
    <h3>Buy Phone Number</h3>
    <select id="telecom">
      <option value="">Choose Company</option>
      <option value="Orange">Orange</option>
      <option value="Vodafone">Vodafone</option>
      <option value="e&">e&</option>
    </select>
    <button onclick="buyNumber()">Buy Number (250 EGP)</button>

    <!-- SIM App -->
    <div id="simApp" class="hidden">
      <h3>SIM App</h3>
      <div><strong>Company:</strong> <span id="simCompany"></span></div>
      <div><strong>Raseed:</strong> <span id="raseed"></span> EGP</div>
      <div><strong>Internet:</strong> <span id="internet"></span> MB</div>
      <select id="bundle">
        <option value="40">40 EGP = 1000MB</option>
        <option value="50">50 EGP = 1250MB</option>
        <option value="60">60 EGP = 1750MB</option>
        <option value="70">70 EGP = 2000MB</option>
        <option value="80">80 EGP = 2500MB</option>
      </select>
      <button onclick="buyBundle()">Buy Internet</button>
      <br/><input id="secretCode" placeholder="Enter secret code" />
      <button onclick="useSecret()">Submit Code</button>
    </div>

    <hr>
        <!-- QR Code Scanner -->
    <h3>QR Code Scanner</h3>
    <input type="file" accept="image/*" capture="environment" onchange="scanQR(event)" />
    <hr>

    <!-- Facenet -->
    <h3>Facenet</h3>
    <input id="postTitle" placeholder="Post title" /><br/>
    <input type="file" accept="image/*" id="postImage" /><br/>
    <button onclick="makePost()">Post</button>

    <div id="facenetPosts"></div>

    <button id="resetBtn" class="hidden" onclick="resetFacenet()">Reset Facenet</button>
  </div>
</div>

<!-- Firebase + QR + Script -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDhS...",
  authDomain: "aya-game-e579b.firebaseapp.com",
  databaseURL: "https://aya-game-e579b-default-rtdb.firebaseio.com",
  projectId: "aya-game-e579b",
  storageBucket: "aya-game-e579b.appspot.com",
  messagingSenderId: "425563173336",
  appId: "1:425563173336:web:4de74ff9fcd07d..."
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser = null;
let cardData = {};
let internetDrain;

function login() {
  const u = document.getElementById("username").value.toLowerCase();
  const p = document.getElementById("pin").value;
  const keep = document.getElementById("keepSigned").checked;

  db.ref("users/" + u).get().then(snap => {
    if (snap.exists() && snap.val().pin === p) {
      currentUser = u;
      (keep ? localStorage : sessionStorage).setItem("user", u);
      loadUser();
    } else {
      alert("Invalid login");
    }
  });
}

function loadUser() {
  document.getElementById("login").classList.add("hidden");
  document.getElementById("main").classList.remove("hidden");

  db.ref("users/" + currentUser).on("value", snap => {
    const data = snap.val();
    document.getElementById("welcome").textContent = `Welcome, ${currentUser}`;
    document.getElementById("money").textContent = data.money;
    document.getElementById("phone").textContent = data.phone || "None";
    document.getElementById("raseed").textContent = data.raseed || 0;
    document.getElementById("internet").textContent = data.internet || 0;

    if (data.company) {
      document.getElementById("simApp").classList.remove("hidden");
      document.getElementById("simCompany").textContent = data.company;
    }

    if (currentUser === "zezo") {
      document.getElementById("resetBtn").classList.remove("hidden");
    }

    startInternetDrain();
  });

  loadPosts();
}

function logout() {
  localStorage.clear(); sessionStorage.clear(); location.reload();
}
<script>
function makeCard() {
  const pin = document.getElementById("cardPin").value;
  if (pin.length !== 3) return alert("PIN must be 3 digits");

  const cardNum = Math.floor(1000 + Math.random() * 9000) + " " + Math.floor(1000 + Math.random() * 9000);
  db.ref("users/" + currentUser + "/card").set({ pin, number: cardNum });
  alert("Card created!");
}

function openCard() {
  const pin = document.getElementById("openCardPin").value;
  db.ref("users/" + currentUser + "/card").get().then(snap => {
    if (!snap.exists() || snap.val().pin !== pin) return alert("Wrong PIN");
    const data = snap.val();
    document.getElementById("cardArea").classList.remove("hidden");
    document.getElementById("cardNumber").textContent = data.number;
    document.getElementById("cardUser").textContent = currentUser;
    document.getElementById("cardQR").src = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${currentUser}`;
  });
}

function buyNumber() {
  const company = document.getElementById("telecom").value;
  if (!company) return alert("Choose company");
  db.ref("users/" + currentUser).get().then(snap => {
    if (snap.val().money < 250) return alert("Not enough money");
    const phone = "01" + Math.floor(100000000 + Math.random() * 900000000);
    db.ref("users/" + currentUser).update({
      money: snap.val().money - 250,
      phone,
      company,
      raseed: 0,
      internet: 0
    });
    alert("Phone number bought!");
  });
}

function buyBundle() {
  const amount = parseInt(document.getElementById("bundle").value);
  const mb = { 40: 1000, 50: 1250, 60: 1750, 70: 2000, 80: 2500 }[amount];

  db.ref("users/" + currentUser).get().then(snap => {
    if (snap.val().raseed < amount) return alert("Not enough Raseed");
    db.ref("users/" + currentUser).update({
      raseed: snap.val().raseed - amount,
      internet: (snap.val().internet || 0) + mb
    });
  });
}

function useSecret() {
  const code = document.getElementById("secretCode").value;
  if (code === "555") {
    const amt = prompt("How much Raseed?");
    db.ref("users/" + currentUser + "/raseed").get().then(snap => {
      db.ref("users/" + currentUser + "/raseed").set((snap.val() || 0) + parseInt(amt));
    });
  }
}

function scanQR(event) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onload = e => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement("canvas");
      canvas.width = img.width; canvas.height = img.height;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0);
      const data = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const code = jsQR(data.data, canvas.width, canvas.height);
      if (code) {
        db.ref("users/" + code.data).get().then(snap => {
          if (!snap.exists()) return alert("Invalid QR");
          const amount = prompt("How much to transfer?");
          db.ref("users/" + currentUser).get().then(mySnap => {
            if (mySnap.val().money < amount) return alert("Not enough money");
            db.ref("users/" + currentUser + "/money").set(mySnap.val().money - amount);
            db.ref("users/" + code.data + "/money").set(snap.val().money + parseInt(amount));
            alert("Transfer complete!");
          });
        });
      } else alert("QR not detected");
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

function makePost() {
  db.ref("users/" + currentUser).get().then(snap => {
    if ((snap.val().internet || 0) < 1) return alert("Need internet!");
    const fileInput = document.getElementById("postImage");
    const reader = new FileReader();
    reader.onload = e => {
      const title = document.getElementById("postTitle").value;
      db.ref("posts").get().then(s => {
        const all = s.val() || {};
        for (let i = 1; i <= 50; i++) {
          if (!all[i]) {
            db.ref("posts/" + i).set({ user: currentUser, title, img: e.target.result });
            break;
          }
        }
      });
    };
    reader.readAsDataURL(fileInput.files[0]);
  });
}

function loadPosts() {
  db.ref("posts").on("value", snap => {
    const area = document.getElementById("facenetPosts");
    area.innerHTML = "";
    const all = snap.val();
    for (let i = 1; i <= 50; i++) {
      if (!all || !all[i]) continue;
      const post = all[i];
      area.innerHTML += `
        <div style="border:1px solid #ccc;padding:10px;margin:5px;">
          <h4>${post.user}: ${post.title}</h4>
          <img src="${post.img}" width="100%" />
        </div>
      `;
    }
  });
}

function resetFacenet() {
  if (confirm("Are you sure?")) db.ref("posts").remove();
}

function startInternetDrain() {
  if (internetDrain) clearInterval(internetDrain);
  internetDrain = setInterval(() => {
    db.ref("users/" + currentUser + "/internet").get().then(snap => {
      let val = snap.val() || 0;
      if (val <= 0) return;
      db.ref("users/" + currentUser + "/internet").set(val - 150);
    });
  }, 60000);
}

window.onload = () => {
  const u = localStorage.getItem("user") || sessionStorage.getItem("user");
  if (u) {
    currentUser = u;
    loadUser();
  }
};
</script>
</body>
</html>