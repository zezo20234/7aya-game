<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sibling Game</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f0f0; margin: 0; padding: 20px; }
    input, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    button { background: #4CAF50; color: white; border: none; cursor: pointer; }
    button:hover { background: #45a049; }
    .top-bar { background: #333; color: white; padding: 10px; display: flex; justify-content: space-between; }
    .sim-logo { height: 40px; cursor: pointer; margin: 10px; }
    #dashboard, #sim-app, #card-container, #facenet, #buy-sim-section { display: none; }
    #card-container { margin-top: 10px; }
    .real-card {
      border-radius: 15px;
      width: 320px;
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      font-family: 'Courier New', Courier, monospace;
    }
    .real-card h3 { margin: 0; font-size: 24px; }
    .facenet-post {
      background: white; padding: 10px; margin: 10px 0;
      border-radius: 8px; box-shadow: 0 0 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<div id="login">
  <h2>Login</h2>
  <input id="username" placeholder="Username">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="login-error" style="color:red;"></p>
</div>

<div id="dashboard">
  <div class="top-bar">
    <div id="user-phone">üìû Phone: None</div>
    <div id="user-money">üí∞ Money: $0</div>
    <div id="user-internet">üåê 0MB</div>
  </div>

  <h3>Welcome, <span id="user-name"></span></h3>

  <button onclick="buySim()">Buy Phone Number</button>
  <div id="buy-sim-section">
    <p>Select your provider:</p>
    <img class="sim-logo" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Orange_logo.svg/2560px-Orange_logo.svg.png" onclick="selectSim('Orange')">
    <img class="sim-logo" src="https://upload.wikimedia.org/wikipedia/commons/9/9d/Vodafone_icon_2022.svg" onclick="selectSim('Vodafone')">
    <img class="sim-logo" src="https://upload.wikimedia.org/wikipedia/commons/b/b3/E%26%26_logo.png" onclick="selectSim('E&')">
  </div>

  <div id="sim-app">
    <h3>SIM App</h3>
    <p>Raseed: <span id="raseed-balance">0</span>$</p>
    <input id="secret-raseed" placeholder="Enter secret code">
    <input id="raseed-amount" type="number" placeholder="Amount to add">
    <button onclick="addRaseed()">Add Raseed</button>
    <h4>Buy Internet</h4>
    <button onclick="buyInternet(100,10)">100MB = 10 Raseed</button>
    <button onclick="buyInternet(2000,50)">2GB = 50 Raseed</button>
    <button onclick="buyInternet(2500,60)">2.5GB = 60 Raseed</button>
    <button onclick="buyInternet(3000,70)">3GB = 70 Raseed</button>
  </div>

  <button onclick="document.getElementById('facenet').style.display='block'">Open FaceNet</button>
  <div id="facenet">
    <h3>FaceNet üß†</h3>
    <input id="post-title" placeholder="Title">
    <input id="post-image" type="file">
    <button onclick="addPost()">Post</button>
    <div id="posts"></div>
  </div>
</div>

<!-- Insert Firebase SDK script block from above here -->

<script>
let currentUser = null;
let usersRef = ref(window.db, "users/");
let postsRef = ref(window.db, "posts/");

async function login() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  const snapshot = await get(ref(window.db, `users/${u}`));
  if (snapshot.exists() && snapshot.val().password === p) {
    currentUser = u;
    document.getElementById("login").style.display = "none";
    document.getElementById("dashboard").style.display = "block";
    document.getElementById("user-name").innerText = u;
    loadData();
  } else {
    document.getElementById("login-error").innerText = "Wrong username or password";
  }
}

function loadData() {
  onValue(ref(window.db, `users/${currentUser}`), snap => {
    const data = snap.val();
    document.getElementById("user-phone").innerText = "üìû Phone: " + (data.phone || "None");
    document.getElementById("user-money").innerText = "üí∞ Money: $" + data.money;
    document.getElementById("user-internet").innerText = "üåê " + data.internet + "MB";
    document.getElementById("raseed-balance").innerText = data.raseed;
  });

  onValue(postsRef, snap => {
    const all = snap.val() || {};
    const postsDiv = document.getElementById("posts");
    postsDiv.innerHTML = "";
    Object.values(all).forEach(post => {
      const div = document.createElement("div");
      div.className = "facenet-post";
      div.innerHTML = `<strong>${post.title}</strong><br><img src="${post.img}" width="100%">`;
      postsDiv.prepend(div);
    });
  });
}

function buySim() {
  document.getElementById("buy-sim-section").style.display = "block";
}

function selectSim(type) {
  const number = "05" + Math.floor(10000 + Math.random() * 89999);
  update(ref(window.db, `users/${currentUser}`), {
    phone: number,
    sim: type,
    money: window.money - 250
  });
  document.getElementById("buy-sim-section").style.display = "none";
  document.getElementById("sim-app").style.display = "block";
}

function addRaseed() {
  const code = document.getElementById("secret-raseed").value;
  const amount = parseInt(document.getElementById("raseed-amount").value);
  if (code === "555" && !isNaN(amount)) {
    const userRef = ref(window.db, `users/${currentUser}`);
    get(userRef).then(snap => {
      const r = (snap.val().raseed || 0) + amount;
      update(userRef, { raseed: r });
    });
  } else {
    alert("Wrong code or invalid amount");
  }
}

function buyInternet(mb, price) {
  const userRef = ref(window.db, `users/${currentUser}`);
  get(userRef).then(snap => {
    const user = snap.val();
    if (user.raseed >= price) {
      update(userRef, {
        raseed: user.raseed - price,
        internet: user.internet + mb
      });
    } else {
      alert("Not enough raseed");
    }
  });
}

function addPost() {
  const title = document.getElementById("post-title").value;
  const file = document.getElementById("post-image").files[0];
  if (!file) return alert("Choose an image");
  const reader = new FileReader();
  reader.onload = function(e) {
    const url = e.target.result;
    const postId = Date.now();
    set(ref(window.db, `posts/${postId}`), { title, img: url });
  };
  reader.readAsDataURL(file);
}

// Internet timer
setInterval(() => {
  if (!currentUser) return;
  const userRef = ref(window.db, `users/${currentUser}`);
  get(userRef).then(snap => {
    const user = snap.val();
    if (user.internet >= 150) {
      update(userRef, { internet: user.internet - 150 });
    } else {
      update(userRef, { internet: 0 });
    }
  });
}, 90000); // Every 1.5 min
</script>
<!-- Firebase SDKs -->
<script type="module">
  // Your Firebase config here
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, get, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD8LLjhoQEefz6dYdhSVbFOsIqvizO8WaY",
    authDomain: "aya-game-e579b.firebaseapp.com",
    databaseURL: "https://aya-game-e579b-default-rtdb.firebaseio.com",
    projectId: "aya-game-e579b",
    storageBucket: "aya-game-e579b.appspot.com",
    messagingSenderId: "609706801625",
    appId: "1:609706801625:web:1e128b6f2c001133c1c1c8",
    measurementId: "G-E6BK1J3X3R"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Make db globally accessible
  window.db = db;
  window.ref = ref;
  window.get = get;
  window.set = set;
  window.update = update;
  window.onValue = onValue;
</script>
</body>
</html>
