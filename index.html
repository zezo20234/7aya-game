<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>7AYA GAME</title>
  <link rel="apple-touch-icon" href="IMG_0383.jpeg">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="7AYA-GAME">
  <style>
    body { font-family: sans-serif; background: #111; color: white; padding: 20px; max-width: 600px; margin: auto;}
    input, select, button { margin: 5px; padding: 8px; border-radius: 5px; border: none; }
    button { background: #0a74da; color: white; cursor: pointer; }
    button:hover { background: #055aab; }
    .hidden { display: none; }
    .card { background: #222; padding: 20px; border-radius: 15px; margin-top: 15px; position: relative;}
    #cardView img { margin-top: 10px; }
    #facenetPosts > div { background: #222; margin-top: 10px; padding: 10px; border-radius: 10px; }
    #facenetPosts img { max-width: 100%; border-radius: 8px; margin-top: 5px; }
  </style>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<!-- Login -->
<div id="login">
  <h2>Login</h2>
  <input id="username" placeholder="Username" autocomplete="off" />
  <input id="pin" placeholder="PIN" type="password" autocomplete="off" />
  <label><input type="checkbox" id="keepSigned" /> Keep me signed in</label><br/>
  <button onclick="login()">Login</button>
</div>

<!-- Main -->
<div id="main" class="hidden">
  <h2 id="welcome"></h2>
  <p>ğŸ’° Money: <span id="money"></span> EGP</p>
  <p>ğŸ“ Phone: <span id="phone"></span></p>
  <p>ğŸ“¶ Raseed: <span id="raseed"></span> | Internet: <span id="internet"></span> MB</p>
  <button onclick="logout()">Logout</button>

  <hr />
  <h3>ğŸ´ Card</h3>
  <input id="cardPin" placeholder="Set 3-digit PIN" maxlength="3" autocomplete="off"/>
  <button onclick="makeCard()">Make Card</button><br/>
  <input id="openCardPin" placeholder="Enter Card PIN" maxlength="3" autocomplete="off"/>
  <button onclick="openCard()">Open Card</button>
  <div id="cardView" class="card hidden"></div>

  <hr />
  <h3>ğŸ“± Buy Phone Number</h3>
  <select id="company">
    <option value="">Choose Company</option>
    <option value="Orange">Orange</option>
    <option value="Vodafone">Vodafone</option>
    <option value="e&">e&</option>
  </select>
  <button onclick="buyNumber()">Buy Phone Number (250 EGP)</button>

  <div id="simApp" class="hidden">
    <h3>SIM App - <span id="simCompany"></span></h3>
    <button onclick="buyBundle(40, 1500)">40 EGP = 1500MB</button>
    <button onclick="buyBundle(50, 1750)">50 EGP = 1750MB</button>
    <button onclick="buyBundle(60, 2250)">60 EGP = 2250MB</button>
    <button onclick="buyBundle(70, 2750)">70 EGP = 2750MB</button>
    <button onclick="buyBundle(80, 4250)">80 EGP = 4250MB</button>
  </div>

  <hr />
  <h3>ğŸ’¡ Secret Codes</h3>
  <input id="secretMoney" placeholder="Secret code for money" autocomplete="off"/>
  <input id="moneyAmount" type="number" placeholder="Set Money Amount" />
  <button onclick="changeMoney()">Change Money</button><br/>
  <input id="secretRaseed" placeholder="Secret code for raseed" autocomplete="off" />
  <input id="raseedAmount" type="number" placeholder="Add Raseed Amount" />
  <button onclick="addRaseed()">Add Raseed</button><br/>
  <!-- Country secret code -->
  <input id="secretCountry" placeholder="Secret code for country" autocomplete="off"/>
  <input id="countryName" placeholder="Enter Country Name" autocomplete="off" />
  <button onclick="changeCountry()">Change Country</button>

  <h3>ğŸ” QR Code Scanner (Send Money)</h3>
  <button onclick="prepareSound(); startQrMoneyTransfer()" id="transferBtn">Transfer Money (Scan QR)</button>
  <div id="scannerContainer" style="margin-top: 10px;">
    <div id="scanner" style="width: 300px; display: none;"></div>
    <div id="qrStatus" style="margin-top: 5px; color: yellow;"></div>
  </div>

  <hr />
  <h3>ğŸŒ Facenet</h3>
  <input id="postTitle" placeholder="Post Title" autocomplete="off"/>
  <input id="postImage" type="file" accept="image/*" />
  <button onclick="makePost()">Post</button>
  <div id="facenetPosts"></div>
  <button id="resetBtn" class="hidden" onclick="resetFacenet()">Reset Facenet (Admin)</button>
  <audio id="successSound" src="https://audio.jukehost.co.uk/1aTbUcc5vRSDBHlwrgNMrAszF5BJ3Q8J" preload="auto"></audio>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD8LLjhoQEefz6dYdhSVbFOsIqvizO8WaY",
    authDomain: "aya-game-e579b.firebaseapp.com",
    databaseURL: "https://aya-game-e579b-default-rtdb.firebaseio.com",
    projectId: "aya-game-e579b",
    storageBucket: "aya-game-e579b.appspot.com",
    messagingSenderId: "425563173336",
    appId: "1:425563173336:web:4de74ff9fcd07d..."
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  let currentUser = null;

  function login() {
    const user = document.getElementById("username").value.trim().toLowerCase();
    const pin = document.getElementById("pin").value.trim();
    if(!user || !pin) return alert("Enter username and PIN");
    db.ref("users/" + user).once("value").then(snap => {
      if (!snap.exists()) return alert("User not found");
      if (snap.val().pin === pin) {
        currentUser = user;
        loadUser();
      } else alert("Incorrect PIN");
    });
  }

  function loadUser() {
    document.getElementById("login").classList.add("hidden");
    document.getElementById("main").classList.remove("hidden");
    db.ref("users/" + currentUser).on("value", snap => {
      const data = snap.val();
      document.getElementById("welcome").innerText = `Welcome, ${currentUser}`;
      document.getElementById("money").innerText = data.money ?? 0;
      document.getElementById("phone").innerText = data.phone || "None";
      document.getElementById("raseed").innerText = data.raseed ?? 0;
      document.getElementById("internet").innerText = data.internet ?? 0;
    });
  }

  function logout() { location.reload(); }

  function makeCard() {
    const pin = document.getElementById("cardPin").value.trim();
    if (pin.length !== 3) return alert("3-digit PIN");
    const cardNum = `${Math.floor(1000 + Math.random()*9000)} ${Math.floor(1000 + Math.random()*9000)}`;
    db.ref("users/" + currentUser + "/card").set({ pin, number: cardNum });
    alert("Card created!");
  }

  function openCard() {
    const pin = document.getElementById("openCardPin").value.trim();
    db.ref("users/" + currentUser + "/card").once("value").then(snap => {
      if (!snap.exists()) return alert("No card");
      const card = snap.val();
      if (card.pin !== pin) return alert("Wrong PIN");
      document.getElementById("cardView").innerHTML = `
        <strong>Card Number:</strong> ${card.number} <br/>
        <strong>User:</strong> ${currentUser.toUpperCase()} <br/>
        <strong>Country:</strong> ${card.country || 'Not set'} <br/>
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${currentUser}" alt="QR Code" />
      `;
      document.getElementById("cardView").classList.remove("hidden");
    });
  }

  function changeMoney() {
    const code = document.getElementById("secretMoney").value.trim();
    const amt = parseInt(document.getElementById("moneyAmount").value);
    if (code === "555" && !isNaN(amt)) {
      db.ref("users/" + currentUser + "/money").set(amt);
    } else alert("Invalid code");
  }

  function addRaseed() {
    const code = document.getElementById("secretRaseed").value.trim();
    const amt = parseInt(document.getElementById("raseedAmount").value);
    if (code === "555" && !isNaN(amt)) {
      db.ref("users/" + currentUser + "/raseed").once("value").then(snap => {
        db.ref("users/" + currentUser + "/raseed").set((snap.val() || 0) + amt);
      });
    } else alert("Invalid code");
  }

  // ğŸ”¹ New: Change Country via secret code
  function changeCountry() {
    const code = document.getElementById("secretCountry").value.trim();
    const country = document.getElementById("countryName").value.trim();
    if (code === "555" && country) {
      db.ref("users/" + currentUser + "/card/country").set(country);
      alert("Country updated!");
    } else alert("Invalid code or empty country name");
  }
</script>
</body>
</html>
