<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>7AYA‑GAME with Facenet & Wi‑Fi</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f5f5f5; }
    #topBar { background: black; color: white; padding:10px; }
    .btn { padding:10px 15px; margin:5px; border:none; background:#333; color:white; border-radius:8px; }
    input,img,video { margin:5px; }
    #facenet, #card, #simApp, #scannerDiv { display:none; margin-top:20px; }
    #card { width:300px;height:180px;margin:20px auto;padding:20px;border-radius:15px;background:#444;color:white;position:relative; }
    #card .chip{width:40px;height:30px;background:gold;position:absolute;left:15px;top:15px;border-radius:5px;}
    #card .card-number{margin-top:60px;font-size:18px;}
    #card .name{position:absolute;bottom:15px;left:15px;font-weight:bold;}
    #qrcode{position:absolute;right:15px;top:60px;}
    #wifiBundles button{margin:3px;}
    .post { border:1px solid #aaa; margin:10px auto; padding:10px; max-width:300px; background:white; }
    .post img { width:100%; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
    const firebaseConfig = { /* YOUR CONFIG */ };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const users = {
      zezo: { pin:"123", money:200, phone:"", raseed:0, mb:0 },
      asser: { pin:"1234", money:200, phone:"", raseed:0, mb:0 },
      layan: { pin:"12345", money:200, phone:"", raseed:0, mb:0 },
      bank: { pin:"555", money:1000, phone:"", raseed:0, mb:0 }
    };
    let currentUser="", cardPIN="";
    let mbInterval=null;

    function updateTopBar(){
      const u=users[currentUser];
      document.getElementById("topBar").innerText=
        `${currentUser.toUpperCase()} | Money: ${u.money} EGP | Phone: ${u.phone||"None"} | Raseed: ${u.raseed} | MB: ${u.mb}`;
    }

    function login(){
      const u=document.getElementById("username").value.toLowerCase();
      const p=document.getElementById("pin").value;
      if(users[u] && users[u].pin===p){
        currentUser=u;
        document.getElementById("loginDiv").style.display="none";
        document.getElementById("mainApp").style.display="block";
        updateTopBar(); loadFacenet();
      } else alert("Invalid login");
    }

    function makeCard(){
      const p=prompt("Set 3-digit card PIN:");
      if(p.length===3){ cardPIN=p; alert("Card created."); }
    }
    function openCard(){
      if(prompt("PIN?")===cardPIN){
        const u=users[currentUser], c=document.getElementById("card");
        c.style.display="block"; c.innerHTML=
          `<div class="chip"></div>
           <div class="card-number">${Math.floor(1e15+Math.random()*9e15)}</div>
           <div class="name">${currentUser.toUpperCase()}</div>
           <div id="qrcode"></div>`;
        QRCode.toCanvas(c.querySelector("#qrcode"), currentUser, {width:60});
      } else alert("Wrong PIN");
    }

    function makeNumber(){
      const co=prompt("Choose: Orange, Vodafone, e&").toLowerCase();
      if(!["orange","vodafone","e&"].includes(co)) return;
      const u=users[currentUser];
      if(u.money<250){ alert("Low money"); return; }
      u.money -= 250;
      u.phone = `${co.toUpperCase()}-01${Math.floor(1e7+Math.random()*9e7)}`;
      alert("Number bought!");
      showSimApp(); updateTopBar();
    }

    function showSimApp(){
      const s=document.getElementById("simApp");
      s.style.display="block"; s.innerHTML=`
        <h3>SIM APP</h3>
        <p>Raseed: ${users[currentUser].raseed} | MB: ${users[currentUser].mb}</p>
        <div id="wifiBundles">
          <button onclick="buyBundle(40,1000)">40=1000MB</button>
          <button onclick="buyBundle(50,1250)">50=1250MB</button>
          <button onclick="buyBundle(60,1750)">60=1750MB</button>
          <button onclick="buyBundle(70,2000)">70=2000MB</button>
          <button onclick="buyBundle(80,2500)">80=2500MB</button>
        </div>
      `;
    }
    function buyBundle(cost,mb){
      const u=users[currentUser];
      if(u.raseed<cost){ alert("Low Raseed"); return; }
      u.raseed -= cost; u.mb += mb;
      alert(`${mb}MB added!`);
      showSimApp(); updateTopBar();
    }

    function startMBTimer(){
      if(mbInterval) clearInterval(mbInterval);
      mbInterval = setInterval(()=>{
        if(users[currentUser].mb>0){
          users[currentUser].mb -=150;
          if(users[currentUser].mb<0) users[currentUser].mb=0;
          updateTopBar();
          if(users[currentUser].mb===0) stopMBTimer();
        }
      },60000);
    }
    function stopMBTimer(){
      clearInterval(mbInterval); mbInterval=null;
      document.getElementById("facenet").style.display="none";
    }

    function loadFacenet(){
      const f=document.getElementById("facenet");
      f.innerHTML = `
        <h3>Facenet Feed</h3>
        <input id="postTitle" placeholder="Title"><br>
        <input type="file" id="postImg"><br>
        <button class="btn" onclick="post()">Post</button>
        <div id="posts"></div>`;
      f.style.display = users[currentUser].mb>0 ? "block":"none";
      if(users[currentUser].mb>0) startMBTimer();

      const postsRef = ref(db, 'posts');
      onValue(postsRef, snapshot => {
        const data=snapshot.val()||{};
        const html = Object.values(data).map(p=>`
          <div class="post"><h4>${p.u}</h4><p>${p.t}</p><img src="${p.i}"></div>`).join('');
        document.getElementById("posts").innerHTML = html;
      });
    }

    function post(){
      if(users[currentUser].mb<=0){ alert("No internet"); return; }
      const t=document.getElementById("postTitle").value;
      const imgFile=document.getElementById("postImg").files[0];
      if(!t||!imgFile){ alert("Add title & photo"); return; }
      const reader=new FileReader();
      reader.onload = e => {
        push(ref(db, 'posts'), { u:currentUser, t, i: e.target.result });
        alert("Posted!");
      };
      reader.readAsDataURL(imgFile);
    }

    function checkCode(){
      if(document.getElementById("codeInput").value==="555"){
        const n=prompt("New balance:");
        users[currentUser].money=parseInt(n)||0;
        alert("Updated"); updateTopBar();
      }
    }

    window.login=login;
    window.makeCard=makeCard; window.openCard=openCard;
    window.makeNumber=makeNumber; window.showSimApp=showSimApp;
    window.buyBundle=buyBundle;
    window.startMBTimer = startMBTimer;
    window.post=post;
    window.checkCode=checkCode;

  </script>
</head>
<body>
  <div id="topBar"></div>
  <div id="loginDiv">
    <h2>Login</h2>
    <input id="username" placeholder="Username"><br>
    <input id="pin" placeholder="PIN" type="password"><br>
    <button class="btn" onclick="login()">Login</button>
  </div>
  <div id="mainApp" style="display:none;">
    <button class="btn" onclick="makeCard()">Make Card</button>
    <button class="btn" onclick="openCard()">Open Card</button>
    <button class="btn" onclick="makeNumber()">Buy Number</button>
    <div id="card"></div>
    <div id="simApp"></div>
    <div id="facenet"></div>
    <input id="codeInput" placeholder="Secret code">
    <button class="btn" onclick="checkCode()">Enter</button>
  </div>
</body>
</html>